From 2e3acb2f908d09bc09fa918f4d07e8b1fbbbbb11 Mon Sep 17 00:00:00 2001
From: Estable Patch Generator
Date: Wed, 15 Jan 2025 18:00:00 +0000
Subject: [PATCH] Bolt integration, env config, vault factory wiring

diff --git a/.env.example b/.env.example
new file mode 100644
index 0000000..2222222
--- /dev/null
+++ b/.env.example
@@ -0,0 +1,14 @@
+# Copy this file → .env
+
+# Wallet used for deployments (Base Sepolia)
+PRIVATE_KEY=
+
+# RPC URL
+BASE_RPC=https://sepolia.base.org
+
+# Timelock contract (fill after deployment)
+TIMELOCK_ADDRESS=
+
+# VaultFactory contract (fill after deployment)
+VAULT_FACTORY_ADDRESS=
+
+ENV_NAME=development

diff --git a/vite.config.ts b/vite.config.ts
index ffffff1..bbbbbbb 100644
--- a/vite.config.ts
+++ b/vite.config.ts
@@ -1,6 +1,15 @@
 import { defineConfig } from "vite";
 import react from "@vitejs/plugin-react";
 
+// Load environment variables
+import dotenv from "dotenv";
+dotenv.config();
+
 export default defineConfig({
   plugins: [react()],
+  define: {
+    __ENV__: JSON.stringify({
+      timelock: process.env.TIMELOCK_ADDRESS || "",
+      factory: process.env.VAULT_FACTORY_ADDRESS || "",
+    }),
+  },
 });

diff --git a/wagmi.config.ts b/wagmi.config.ts
index 08b8a90..aa55aaa 100644
--- a/wagmi.config.ts
+++ b/wagmi.config.ts
@@ -1,7 +1,25 @@
 import { defineConfig } from "wagmi";
-import { mainnet, base } from "wagmi/chains";
+import { mainnet, base, baseSepolia } from "wagmi/chains";
 import { injected } from "wagmi/connectors";
 
 export default defineConfig({
-  chains: [mainnet, base],
-  connectors: [injected()],
+  chains: [mainnet, base, baseSepolia],
+  connectors: [
+    injected({
+      target: "metaMask",
+    }),
+  ],
+  transports: {
+    [baseSepolia.id]: {
+      url: process.env.BASE_RPC || "https://sepolia.base.org"
+    },
+    [base.id]: {
+      url: "https://mainnet.base.org"
+    }
+  }
 });

diff --git a/lib/contracts.ts b/lib/contracts.ts
index 9191919..3636363 100644
--- a/lib/contracts.ts
+++ b/lib/contracts.ts
@@ -1,6 +1,61 @@
-export const CONTRACTS = {
-  vault: "",
-};
+// Dynamic contract loader used by frontend
+
+import deployed from "../contracts/deployed.json";
+
+export const getContractAddress = (name: string): string => {
+  // Prefer .env → then deployed.json → fall back empty
+
+  if (name === "timelock") {
+    return __ENV__.timelock || deployed.timelock || "";
+  }
+  if (name === "factory") {
+    return __ENV__.factory || deployed.factory || "";
+  }
+  return "";
+};
+
+export const loadABI = async (name: string): Promise<any> => {
+  const res = await fetch(`/contracts/${name}.json`);
+  return res.json();
+};

diff --git a/lib/api.ts b/lib/api.ts
index 44ac911..7777777 100644
--- a/lib/api.ts
+++ b/lib/api.ts
@@ -1,6 +1,58 @@
-export const hello = () => "api";
+import { getContractAddress, loadABI } from "./contracts";
+import { createPublicClient, http, createWalletClient } from "viem";
+import { baseSepolia } from "viem/chains";
+
+export const client = createPublicClient({
+  chain: baseSepolia,
+  transport: http(process.env.BASE_RPC || "https://sepolia.base.org"),
+});
+
+export const getVaultsFromFactory = async () => {
+  const factoryAddr = getContractAddress("factory");
+  if (!factoryAddr) return [];
+
+  const abi = await loadABI("VaultFactory");
+
+  return client.readContract({
+    address: factoryAddr as `0x${string}`,
+    abi,
+    functionName: "getAllVaults",
+  });
+};
+
+export const getTimelockQueuedActions = async () => {
+  const timelock = getContractAddress("timelock");
+  if (!timelock) return [];
+
+  const abi = await loadABI("Timelock");
+
+  return client.readContract({
+    address: timelock as `0x${string}`,
+    abi,
+    functionName: "getPendingActions",
+  });
+};

diff --git a/components/Vaults.tsx b/components/Vaults.tsx
index 77aaaa7..88bbbb8 100644
--- a/components/Vaults.tsx
+++ b/components/Vaults.tsx
@@ -1,5 +1,29 @@
 import React from "react";
-import { useState } from "react";
+import { useState, useEffect } from "react";
+import { getVaultsFromFactory } from "../lib/api";
+
+export default function Vaults() {
+  const [vaults, setVaults] = useState<string[]>([]);
+
+  useEffect(() => {
+    (async () => {
+      const v = await getVaultsFromFactory();
+      if (Array.isArray(v)) {
+        setVaults(v);
+      }
+    })();
+  }, []);
+
+  if (!vaults.length) {
+    return <div>No vaults deployed yet.</div>;
+  }
+
+  return (
+    <div>
+      <h2>Deployed Vaults</h2>
+      <ul>
+        {vaults.map((v) => (
+          <li key={v}>{v}</li>
+        ))}
+      </ul>
+    </div>
+  );
+}

diff --git a/contracts/deployed.json b/contracts/deployed.json
new file mode 100644
index 0000000..1111111
--- /dev/null
+++ b/contracts/deployed.json
@@ -0,0 +1,6 @@
+{
+  "timelock": "",
+  "factory": "",
+  "vaults": []
+}

diff --git a/scripts/deploy.js b/scripts/deploy.js
index 8888888..5555555 100644
--- a/scripts/deploy.js
+++ b/scripts/deploy.js
@@ -1,6 +1,54 @@
-// old deploy file
+import { ethers } from "hardhat";
+import fs from "fs";
+
+async function main() {
+  const [deployer] = await ethers.getSigners();
+
+  console.log("Deploying contracts using:", deployer.address);
+
+  // Example: deploy timelock or vaults AFTER you fill this in
+  // const Timelock = await ethers.getContractFactory("YourTimelock");
+  // const timelock = await Timelock.deploy(86400);
+  // await timelock.waitForDeployment();
+
+  // Save for frontend
+  const out = {
+    timelock: "",
+    factory: "",
+    vaults: [],
+  };
+
+  fs.writeFileSync("./contracts/deployed.json", JSON.stringify(out, null, 2));
+
+  console.log("Deployment placeholder written → contracts/deployed.json");
+}
+
+main().catch((err) => {
+  console.error(err);
+  process.exit(1);
+});

diff --git a/scripts/deploy-timelock.js b/scripts/deploy-timelock.js
index eee1111..ccc3333 100644
--- a/scripts/deploy-timelock.js
+++ b/scripts/deploy-timelock.js
@@ -1,3 +1,46 @@
-// placeholder
+import { ethers } from "hardhat";
+import fs from "fs";
+
+async function main() {
+  const DELAY = 86400; // 24h, user will adjust later
+
+  const Timelock = await ethers.getContractFactory("Timelockable");
+  const timelock = await Timelock.deploy(DELAY);
+  await timelock.waitForDeployment();
+
+  console.log("Timelock deployed at:", timelock.target);
+
+  // update frontend deploy file
+  const deployed = JSON.parse(fs.readFileSync("./contracts/deployed.json"));
+  deployed.timelock = timelock.target;
+  fs.writeFileSync("./contracts/deployed.json", JSON.stringify(deployed, null, 2));
+}
+
+main().catch((err) => {
+  console.error(err);
+  process.exit(1);
+});
--
2.34.1
